# БАЗЫ ДАННЫХ. ЛФБОРАТОРНАЯ РАБОТА №1.
## Выбор предметной области.
Предметная область для этой базы данных - список юзеров некоторого воображаемого сервера. Уникальным индентефикатором является ip-адрес пользователя(предположим, что каждый пользователь заходит только под одним ip). Кроме этого, база данных содержит информацию о имени пользователя, хеше ключа пользователя и "уровне допуска" пользователя.   
## Пример данных:
```
┌───────────────┬────────────────────┬────────────────────┬────┐
│ip             │user                │hash                │perm│
├───────────────┼────────────────────┼────────────────────┼────┤
│125.0.0.2      │user2               │oijohbsdvigsdvhjg   │r   │
├───────────────┼────────────────────┼────────────────────┼────┤
│125.0.0.3      │user3               │oijsdvsddvsvds      │rw  │
├───────────────┼────────────────────┼────────────────────┼────┤
│125.0.0.4      │user4               │oijsdvsddvsvds      │rw  │
├───────────────┼────────────────────┼────────────────────┼────┤
│125.0.0.5      │user5               │oijsdvsddvsvds      │rw  │
├───────────────┼────────────────────┼────────────────────┼────┤
│892.2.2.3      │newuser             │woidjfkjsd          │rwx │
└───────────────┴────────────────────┴────────────────────┴────┘
```
## Алгоритм поиска и анализ его эффективности.
В основе алгоритма поиска лежат словари. При загрузке базы данных из файла создаётся список всех записей, и четыре словаря, ключами в которых является значение соответствующего поля, а значением - индекс записи, которая содержит это поле, в списке. Словари используют хеш-таблицы, соответственно, в лучшем случае время поиска - константа, в худшем - n.   
Удаление представляет собой запись в список по соответствующему индексу None. При записи базы данных в файл(все операции проводятся базой, полностью загруженной в оперативную помять) все None элементы списка с записями игнорируются.
## Измерение времени работы.
Измерение проводилось самым простым способом из существующих, и даже близко не претендует на достоверность. Вообще, измерять производительность кода на питоне сомнительная идея, имхо. Ну, в тз написано замерить, я замерил.   
Результаты следующие:   
```
Loading empty db
0.0009987354278564453
Add 10000 records
0.0469670295715332
Save db with 10000 records
0.024001121520996094
Load db with 10000 records
0.043973684310913086
Find 10000 times
0.14990663528442383
Delete 10000 records
6.768826723098755
Save db with 10000 deleted records
0.0009999275207519531
```
Методика измерения применялась такая:   
``` python
start = time.time()
for i in range(0, 10000):
    find_record(db, records[random.randint(0, len(records) - 1)])
end = time.time()
print("Find 10000 times")
print(end - start)
```   
Хорошие или плохие показатели по времени судить не берусь. Да и кто вообще пишет высокопроизводительные штуки на питоне? В любом случае, с алгоритмической точки зрения всё хорошо.  
## GUI(nope, CLI)
В тз указан гуи. Его здесь нет по двум причинам.
* Я считаю, что хороший консольный интерфейс куда лучше гуи. (ремарка - мой интерфейс не претендует на хорошесть)
* Мне было лень разбираться с гуи на питоне.     

В результате, с интерфейсом порльзователя получилось следующее:
```
┌──────────────────────────────────────────────────────────────┐
│          Welcome to the database management system.          │
└──────────────────────────────────────────────────────────────┘
┌──────────────────────────────────────────────────────────────┐
│ Input path:                                                  │
│ C:\Users\mttpr\Desktop\dblab\sample.txt                      │
│                                                              │
│ Checking input path.                                         │
│ Checking input path - done.                                  │
│                                                              │
│ Opening database.                                            │
│ Opening database - done.                                     │
└──────────────────────────────────────────────────────────────┘
┌──────────────────────────────────────────────────────────────┐
│              Database loaded and ready to work.              │
└──────────────────────────────────────────────────────────────┘
┌──────────────────────────────────────────────────────────────┐
│ Command list:                                                │
│                                                              │
│ h - show command list.                                       │
│ a - add record.                                              │
│ f - find record.                                             │
│ e - edit record.                                             │
│ d - delete record.                                           │
│ s - save database.                                           │
│ q - quit.                                                    │
│                                                              │
│ Additional commands:                                         │
│                                                              │
│ backup - create backup.                                      │
│ export - export to .csv file.                                │
└──────────────────────────────────────────────────────────────┘
┌──────────────────────────────────────────────────────────────┐
│ Waiting for command.                                         │
└──────────────────────────────────────────────────────────────┘
>> f
┌──────────────────────────────────────────────────────────────┐
│ Find records.                                                │
│                                                              │
│ Waiting for search request.                                  │
└──────────────────────────────────────────────────────────────┘
>> *,*,*,*
┌──────────────────────────────────────────────────────────────┐
│ Found records:                                               │
└──────────────────────────────────────────────────────────────┘
┌───────────────┬────────────────────┬────────────────────┬────┐
│ip             │user                │hash                │perm│
├───────────────┼────────────────────┼────────────────────┼────┤
│125.0.0.1      │user1               │jdafbhvjsxh         │rw+ │
├───────────────┼────────────────────┼────────────────────┼────┤
│125.0.0.2      │user2               │oijohbsdvigsdvhjg   │r   │
├───────────────┼────────────────────┼────────────────────┼────┤
│125.0.0.3      │user3               │oijsdvsddvsvds      │rw  │
├───────────────┼────────────────────┼────────────────────┼────┤
│125.0.0.4      │user4               │oijsdvsddvsvds      │rw  │
├───────────────┼────────────────────┼────────────────────┼────┤
│125.0.0.5      │user5               │oijsdvsddvsvds      │rw  │
├───────────────┼────────────────────┼────────────────────┼────┤
│892.2.2.3      │newuser             │woidjfkjsd          │rwx │
└───────────────┴────────────────────┴────────────────────┴────┘
```
Как запустить скрипт:
```bash
usage: ui.py [-h] -p PATH [-n NEW]

Database management system.

optional arguments:
  -h, --help            show this help message and exit
  -p PATH, --path PATH  Path to .txt file with database.
  -n NEW, --new NEW     Create new database
```
Путь на самом деле обязательный, но argparse решил иначе, а разбираться почему не слишком хочется.   
Что происходит при запуске скрипта с интерфейсом:
* Проверяется, существует ли директория, к которой указан путь
* Если введен ключ на создание нового файла, создаётся новый файл
* Если нет, проверяется существует ли выбранный файл
* Файл открывается, записи преобразовываются согласно алгоритму, описанному выше  

## Реализованный функционал
Собственно, добавить, найти изменить и удалить запись можно, да. Единственное что стоит описать - синтаксис поисковых запросов. Поисковой запрос представляет из себя строку вида:
```
*,*,*,*
```
Где каждая звёздочка - поле. Звёздочка соответствует выбору всех полей. Любая строка вместо звёздочки сравнивается с соответсвующим полем **по полному совпадению**. Потому что лень возиться с регулярками. Бекап и экспорт в .csv сохраняет файл в ту-же директорию, где находится исходный файл. Почему. Потому что мне было лень.
